{"version":3,"file":"cache-storage.js","sourceRoot":"","sources":["../src/cache-storage.ts"],"names":[],"mappings":"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","sourcesContent":["import { Storage } from '@ionic/storage';\n\nexport interface StorageCacheItem {\n  key: string;\n  value: any;\n  expires: number;\n  type: string;\n  groupKey: string;\n}\n\nexport class CacheStorageService {\n  constructor(\n    private storage: Storage,\n    private keyPrefix: string\n  ) {\n  }\n\n  public ready() {\n    return this.storage.ready();\n  }\n\n  public async set(key: string, value: any) {\n    await this.ready();\n\n    return this.storage.set(this.buildKey(key), value);\n  }\n\n  public async remove(key: string) {\n    await this.ready();\n\n    return this.storage.remove(this.buildKey(key));\n  }\n\n  public async get(key: string) {\n    await this.ready();\n\n    let value = await this.storage.get(this.buildKey(key));\n    return !!value ? Object.assign({ key: key }, value) : null;\n  }\n\n  public async exists(key: string) {\n    await this.ready();\n\n    return !!(await this.storage.get(this.buildKey(key)));\n  }\n\n  public async all(): Promise<StorageCacheItem[]> {\n    await this.ready();\n\n    let items: StorageCacheItem[] = [];\n    await this.storage.forEach((val: any, key: string) => {\n      if (this.isCachedItem(key, val)) {\n        items.push(Object.assign({ key: this.debuildKey(key) }, val));\n      }\n    });\n\n    return items;\n  }\n\n  /**\n   * @description Returns whether or not an object is a cached item.\n   * @return {boolean}\n   */\n  private isCachedItem(key: string, item: any): boolean {\n    return item && item.expires && item.type && key.startsWith(this.keyPrefix);\n  }\n\n  /**\n   * Makes sure that the key is prefixed properly\n   * @return {string}\n   */\n  private buildKey(key: string): string {\n    if (key.startsWith(this.keyPrefix)) {\n      return key;\n    }\n\n    return this.keyPrefix + key;\n  }\n\n  /**\n   * Makes sure that the key isn't prefixed\n   * @return {string}\n   */\n  private debuildKey(key: string): string {\n    if (key.startsWith(this.keyPrefix)) {\n      return key.substr(this.keyPrefix.length);\n    }\n\n    return key;\n  }\n}\n"]}