!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-stripe",["exports","@angular/common","@angular/core","rxjs","rxjs/operators"],t):t(e["ngx-stripe"]={},e.ng.common,e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,r,t,a,s){"use strict";var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var u=function(){function e(e){this.platformId=e}return e.prototype.getNativeWindow=function(){return r.isPlatformBrowser(this.platformId)?window:{}},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},e}(),c=function(){function e(e){this.platformId=e}return e.prototype.getNativeDocument=function(){return r.isPlatformBrowser(this.platformId)?document:{}},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},e}(),p=function(){function e(e,t,n){this.platformId=e,this.window=t,this.document=n,this.status=new a.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!r.isPlatformServer(this.platformId)){var t=this.status.getValue();if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!t.loaded&&!t.loading){this.status.next(o({},t,{loading:!0}));var n=this.document.getNativeDocument().createElement("script");n.type="text/javascript",n.async=!0,n.defer=!0,n.src="https://js.stripe.com/v3/",n.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},n.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(n)}}},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:u},{type:c}]},e}(),f=new t.InjectionToken("Stripe Publishable Key"),l=new t.InjectionToken("Stripe Options");function d(e){return"type"in e}function y(e){return"bank_account"===e}function h(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type||e.account_holder_type===undefined)}function m(e){return"pii"===e}function v(e){return"personal_id_number"in e}var b=function(){function e(e,t,n,r){var o=this;this.loader=e,this.window=t,this.key=n,this.options=r,this.stripe$=new a.BehaviorSubject(undefined),this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.first(),s.map(function(){return o.window.getNativeWindow().Stripe})).subscribe(function(e){var t=o.options?e(o.key,o.options):e(o.key);o.stripe$.next(t)})}return e.prototype.getInstance=function(){return this.stripe$.getValue()},e.prototype.elements=function(t){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.map(function(e){return e.elements(t)}),s.first())},e.prototype.createToken=function(o,i){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return function n(e){return"account"===e}(o)&&function r(e){return e.legal_entity||e.tos_shown_and_accepted}(i)||y(o)&&h(i)||m(o)&&v(i),a.from(t.createToken(o,i))}),s.first())},e.prototype.createSource=function(n,r){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return d(n)?a.from(t.createSource(n)):a.from(t.createSource(n,r))}),s.first())},e.prototype.retrieveSource=function(n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.retrieveSource(n))}),s.first())},e.prototype.paymentRequest=function(e){var t=this.getInstance();return t?t.paymentRequest(e):undefined},e.prototype.handleCardPayment=function(r,o,i){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return function n(e){return"type"in e}(o)?a.from(t.handleCardPayment(r,o)):a.from(t.handleCardPayment(r,o,i))}))},e.prototype.handleCardAction=function(n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.handleCardAction(n))}))},e.prototype.confirmPaymentIntent=function(n,r){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.confirmPaymentIntent(n,r))}))},e.prototype.createPaymentMethod=function(n,r,o){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.createPaymentMethod(n,r,o))}),s.first())},e}(),g=function(){function e(e,t,n,r){this.key=e,this.options=t,this.loader=n,this.window=r,e&&(this.stripe=new b(this.loader,this.window,e,t))}return e.prototype.getStripeReference=function(){var e=this;return this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.map(function(){return e.window.getNativeWindow().Stripe}))},e.prototype.getInstance=function(){return this.stripe.getInstance()},e.prototype.setKey=function(e,t){return this.changeKey(e,t)},e.prototype.changeKey=function(e,t){return this.stripe=new b(this.loader,this.window,e,t),this.stripe},e.prototype.elements=function(e){return this.stripe.elements(e)},e.prototype.createToken=function(e,t){return this.stripe.createToken(e,t)},e.prototype.createSource=function(e,t){return this.stripe.createSource(e,t)},e.prototype.retrieveSource=function(e){return this.stripe.retrieveSource(e)},e.prototype.paymentRequest=function(e){return this.stripe.paymentRequest(e)},e.prototype.handleCardPayment=function(e,t,n){return this.stripe.handleCardPayment(e,t,n)},e.prototype.handleCardAction=function(e){return this.stripe.handleCardAction(e)},e.prototype.createPaymentMethod=function(e,t,n){return this.stripe.createPaymentMethod(e,t,n)},e.prototype.confirmPaymentIntent=function(e,t){return this.stripe.confirmPaymentIntent(e,t)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[f]}]},{type:undefined,decorators:[{type:t.Inject,args:[l]}]},{type:p},{type:u}]},e}(),w=function(){function e(e,t,n,r){this.baseKey=e,this.baseOptions=t,this.loader=n,this.window=r}return e.prototype.create=function(e,t){return new b(this.loader,this.window,e,t)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[f]}]},{type:String,decorators:[{type:t.Inject,args:[l]}]},{type:p},{type:u}]},e}(),S=function(){function e(e){this.stripeService=e,this.card=new t.EventEmitter,this.on=new t.EventEmitter,this.options$=new a.BehaviorSubject({}),this.elementsOptions$=new a.BehaviorSubject({}),this.stripe$=new a.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stripe",{set:function(e){this.stripe$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var o=this,e=a.combineLatest(this.elementsOptions$.asObservable(),this.stripe$.asObservable()).pipe(s.switchMap(function(e){var t=i(e,2),n=t[0],r=t[1];return r?0<Object.keys(n).length?r.elements(n):r.elements():0<Object.keys(n).length?o.stripeService.elements(n):o.stripeService.elements()}));a.combineLatest(e,this.options$.asObservable().pipe(s.filter(function(e){return Boolean(e)}))).subscribe(function(e){var t=i(e,2),n=t[0],r=t[1];o.element=n.create("card",r),o.element.on("blur",function(e){return o.on.emit({event:e,type:"blur"})}),o.element.on("change",function(e){return o.on.emit({event:e,type:"change"})}),o.element.on("click",function(e){return o.on.emit({event:e,type:"click"})}),o.element.on("focus",function(e){return o.on.emit({event:e,type:"focus"})}),o.element.on("ready",function(e){return o.on.emit({event:e,type:"ready"})}),o.element.mount(o.stripeCard.nativeElement),o.card.emit(o.element)})},e.prototype.getCard=function(){return this.element},e.decorators=[{type:t.Component,args:[{selector:"ngx-stripe-card",template:'\n    <div class="field" #stripeCard></div>\n  '}]}],e.ctorParameters=function(){return[{type:g}]},e.propDecorators={card:[{type:t.Output}],on:[{type:t.Output}],stripeCard:[{type:t.ViewChild,args:["stripeCard"]}],options:[{type:t.Input}],elementsOptions:[{type:t.Input}],stripe:[{type:t.Input}]},e}(),n=function(){function n(){}return n.forRoot=function(e,t){return{ngModule:n,providers:[p,g,w,u,c,{provide:f,useValue:e},{provide:l,useValue:t}]}},n.forChild=function(e,t){return{ngModule:n,providers:[p,g,w,u,c,{provide:f,useValue:e},{provide:l,useValue:t}]}},n.decorators=[{type:t.NgModule,args:[{declarations:[S],exports:[S]}]}],n}();e.NgxStripeModule=n,e.StripeCardComponent=S,e.StripeService=g,e.StripeFactoryService=w,e.StripeInstance=b,e.LazyStripeAPILoader=p,e.WindowRef=u,e.DocumentRef=c,e.isSourceData=d,e.STRIPE_PUBLISHABLE_KEY=f,e.STRIPE_OPTIONS=l,e.isBankAccount=y,e.isBankAccountData=h,e.isPii=m,e.isPiiData=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-stripe.umd.min.js.map