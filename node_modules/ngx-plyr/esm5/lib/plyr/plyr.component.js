/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, Input, NgZone, Output, Renderer2, ViewChild } from '@angular/core';
import Plyr from 'plyr';
import { BehaviorSubject, Observable } from 'rxjs';
import { filter, first, switchMap } from 'rxjs/operators';
import { DefaultPlyrDriver } from '../plyr-driver/default-plyr-driver';
/**
 * @record
 */
function PlyrSimpleChanges() { }
if (false) {
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrType;
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrTitle;
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrPoster;
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrSources;
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrTracks;
    /** @type {?} */
    PlyrSimpleChanges.prototype.plyrOptions;
}
var PlyrComponent = /** @class */ (function () {
    function PlyrComponent(elementRef, ngZone, renderer) {
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.playerChange = new BehaviorSubject(null);
        this.events = new Map();
        this.plyrType = 'video';
        // ngx-plyr events
        this.plyrInit = (/** @type {?} */ (this.playerChange.pipe(filter(function (player) { return !!player; }))));
        // standard media events
        this.plyrProgress = this.createLazyEvent('progress');
        this.plyrPlaying = this.createLazyEvent('playing');
        this.plyrPlay = this.createLazyEvent('play');
        this.plyrPause = this.createLazyEvent('pause');
        this.plyrTimeUpdate = this.createLazyEvent('timeupdate');
        this.plyrVolumeChange = this.createLazyEvent('volumechange');
        this.plyrSeeking = this.createLazyEvent('seeking');
        this.plyrSeeked = this.createLazyEvent('seeked');
        this.plyrRateChange = this.createLazyEvent('ratechange');
        this.plyrEnded = this.createLazyEvent('ended');
        this.plyrEnterFullScreen = this.createLazyEvent('enterfullscreen');
        this.plyrExitFullScreen = this.createLazyEvent('exitfullscreen');
        this.plyrCaptionsEnabled = this.createLazyEvent('captionsenabled');
        this.plyrCaptionsDisabled = this.createLazyEvent('captionsdisabled');
        this.plyrLanguageChange = this.createLazyEvent('languagechange');
        this.plyrControlsHidden = this.createLazyEvent('controlshidden');
        this.plyrControlsShown = this.createLazyEvent('controlsshown');
        this.plyrReady = this.createLazyEvent('ready');
        // HTML5 events
        this.plyrLoadStart = this.createLazyEvent('loadstart');
        this.plyrLoadedData = this.createLazyEvent('loadeddata');
        this.plyrLoadedMetadata = this.createLazyEvent('loadedmetadata');
        this.plyrQualityChange = this.createLazyEvent('qualitychange');
        this.plyrCanPlay = this.createLazyEvent('canplay');
        this.plyrCanPlayThrough = this.createLazyEvent('canplaythrough');
        this.plyrStalled = this.createLazyEvent('stalled');
        this.plyrWaiting = this.createLazyEvent('waiting');
        this.plyrEmptied = this.createLazyEvent('emptied');
        this.plyrCueChange = this.createLazyEvent('cuechange');
        this.plyrError = this.createLazyEvent('error');
        // YouTube events
        this.plyrStateChange = this.createLazyEvent('statechange');
        this.subscriptions = [];
    }
    Object.defineProperty(PlyrComponent.prototype, "player", {
        get: /**
         * @return {?}
         */
        function () {
            return this.playerChange.getValue();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} changes
     * @return {?}
     */
    PlyrComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        var _this = this;
        this.subscriptions.push(this.plyrInit.pipe(first()).subscribe(function (player) {
            if (changes.plyrOptions) {
                if (!changes.plyrOptions.firstChange) {
                    _this.initPlyr(true);
                }
            }
            else {
                _this.updatePlyrSource(player);
            }
        }));
    };
    /**
     * @return {?}
     */
    PlyrComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroyPlayer();
        this.subscriptions.forEach(function (s) { return s.unsubscribe(); });
    };
    /**
     * @return {?}
     */
    PlyrComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initPlyr();
    };
    /**
     * @private
     * @param {?=} force
     * @return {?}
     */
    PlyrComponent.prototype.initPlyr = /**
     * @private
     * @param {?=} force
     * @return {?}
     */
    function (force) {
        var _this = this;
        if (force === void 0) { force = false; }
        if (force || !this.player) {
            this.ngZone.runOutsideAngular(function () {
                _this.destroyPlayer();
                _this.driver = _this.plyrDriver || new DefaultPlyrDriver();
                _this.ensureVideoElement();
                /** @type {?} */
                var newPlayer = _this.driver.create({
                    videoElement: _this.videoElement,
                    options: _this.plyrOptions,
                });
                _this.updatePlyrSource(newPlayer);
                _this.playerChange.next(newPlayer);
            });
        }
    };
    /**
     * @private
     * @param {?} plyr
     * @return {?}
     */
    PlyrComponent.prototype.updatePlyrSource = /**
     * @private
     * @param {?} plyr
     * @return {?}
     */
    function (plyr) {
        this.driver.updateSource({
            videoElement: this.videoElement,
            plyr: plyr,
            source: {
                type: this.plyrType,
                title: this.plyrTitle,
                sources: this.plyrSources,
                poster: this.plyrPoster,
                tracks: this.plyrTracks,
            },
        });
    };
    // see https://stackoverflow.com/a/53704102/1990451
    // see https://stackoverflow.com/a/53704102/1990451
    /**
     * @private
     * @template T
     * @param {?} name
     * @return {?}
     */
    PlyrComponent.prototype.createLazyEvent = 
    // see https://stackoverflow.com/a/53704102/1990451
    /**
     * @private
     * @template T
     * @param {?} name
     * @return {?}
     */
    function (name) {
        var _this = this;
        return (/** @type {?} */ (this.plyrInit.pipe(switchMap(function () { return new Observable(function (observer) { return _this.on(name, function (data) { return _this.ngZone.run(function () { return observer.next(data); }); }); }); }))));
    };
    /**
     * @private
     * @return {?}
     */
    PlyrComponent.prototype.destroyPlayer = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.player) {
            Array.from(this.events.keys()).forEach(function (name) { return _this.off(name); });
            this.driver.destroy({
                plyr: this.player,
            });
            this.videoElement = null;
        }
    };
    Object.defineProperty(PlyrComponent.prototype, "hostElement", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.elementRef.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    // this method is required because the plyr inserts clone of the original element on destroy
    // so we catch the clone element right here and reuse it
    // this method is required because the plyr inserts clone of the original element on destroy
    // so we catch the clone element right here and reuse it
    /**
     * @private
     * @return {?}
     */
    PlyrComponent.prototype.ensureVideoElement = 
    // this method is required because the plyr inserts clone of the original element on destroy
    // so we catch the clone element right here and reuse it
    /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var videoElement = this.hostElement.querySelector('video');
        if (videoElement) {
            this.videoElement = videoElement;
        }
        else {
            this.videoElement = this.renderer.createElement('video');
            this.videoElement.controls = true;
            this.videoElement.setAttribute('crossorigin', '');
            this.videoElement.setAttribute('playsinline', '');
            this.renderer.appendChild(this.hostElement, this.videoElement);
        }
    };
    /**
     * @private
     * @param {?} name
     * @param {?} handler
     * @return {?}
     */
    PlyrComponent.prototype.on = /**
     * @private
     * @param {?} name
     * @param {?} handler
     * @return {?}
     */
    function (name, handler) {
        this.events.set(name, handler);
        this.player.on((/** @type {?} */ (name)), handler);
    };
    /**
     * @private
     * @param {?} name
     * @return {?}
     */
    PlyrComponent.prototype.off = /**
     * @private
     * @param {?} name
     * @return {?}
     */
    function (name) {
        this.player.off((/** @type {?} */ (name)), this.events.get(name));
        this.events.delete(name);
    };
    PlyrComponent.decorators = [
        { type: Component, args: [{
                    selector: 'plyr, [plyr]',
                    // tslint:disable-line
                    template: "",
                    exportAs: 'plyr',
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PlyrComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgZone },
        { type: Renderer2 }
    ]; };
    PlyrComponent.propDecorators = {
        plyrDriver: [{ type: Input }],
        plyrType: [{ type: Input }],
        plyrTitle: [{ type: Input }],
        plyrPoster: [{ type: Input }],
        plyrSources: [{ type: Input }],
        plyrTracks: [{ type: Input }],
        plyrOptions: [{ type: Input }],
        vr: [{ type: ViewChild, args: ['v',] }],
        plyrInit: [{ type: Output }],
        plyrProgress: [{ type: Output }],
        plyrPlaying: [{ type: Output }],
        plyrPlay: [{ type: Output }],
        plyrPause: [{ type: Output }],
        plyrTimeUpdate: [{ type: Output }],
        plyrVolumeChange: [{ type: Output }],
        plyrSeeking: [{ type: Output }],
        plyrSeeked: [{ type: Output }],
        plyrRateChange: [{ type: Output }],
        plyrEnded: [{ type: Output }],
        plyrEnterFullScreen: [{ type: Output }],
        plyrExitFullScreen: [{ type: Output }],
        plyrCaptionsEnabled: [{ type: Output }],
        plyrCaptionsDisabled: [{ type: Output }],
        plyrLanguageChange: [{ type: Output }],
        plyrControlsHidden: [{ type: Output }],
        plyrControlsShown: [{ type: Output }],
        plyrReady: [{ type: Output }],
        plyrLoadStart: [{ type: Output }],
        plyrLoadedData: [{ type: Output }],
        plyrLoadedMetadata: [{ type: Output }],
        plyrQualityChange: [{ type: Output }],
        plyrCanPlay: [{ type: Output }],
        plyrCanPlayThrough: [{ type: Output }],
        plyrStalled: [{ type: Output }],
        plyrWaiting: [{ type: Output }],
        plyrEmptied: [{ type: Output }],
        plyrCueChange: [{ type: Output }],
        plyrError: [{ type: Output }],
        plyrStateChange: [{ type: Output }]
    };
    return PlyrComponent;
}());
export { PlyrComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.playerChange;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.events;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrDriver;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrType;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrTitle;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrPoster;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrSources;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrTracks;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.plyrOptions;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.vr;
    /** @type {?} */
    PlyrComponent.prototype.plyrInit;
    /** @type {?} */
    PlyrComponent.prototype.plyrProgress;
    /** @type {?} */
    PlyrComponent.prototype.plyrPlaying;
    /** @type {?} */
    PlyrComponent.prototype.plyrPlay;
    /** @type {?} */
    PlyrComponent.prototype.plyrPause;
    /** @type {?} */
    PlyrComponent.prototype.plyrTimeUpdate;
    /** @type {?} */
    PlyrComponent.prototype.plyrVolumeChange;
    /** @type {?} */
    PlyrComponent.prototype.plyrSeeking;
    /** @type {?} */
    PlyrComponent.prototype.plyrSeeked;
    /** @type {?} */
    PlyrComponent.prototype.plyrRateChange;
    /** @type {?} */
    PlyrComponent.prototype.plyrEnded;
    /** @type {?} */
    PlyrComponent.prototype.plyrEnterFullScreen;
    /** @type {?} */
    PlyrComponent.prototype.plyrExitFullScreen;
    /** @type {?} */
    PlyrComponent.prototype.plyrCaptionsEnabled;
    /** @type {?} */
    PlyrComponent.prototype.plyrCaptionsDisabled;
    /** @type {?} */
    PlyrComponent.prototype.plyrLanguageChange;
    /** @type {?} */
    PlyrComponent.prototype.plyrControlsHidden;
    /** @type {?} */
    PlyrComponent.prototype.plyrControlsShown;
    /** @type {?} */
    PlyrComponent.prototype.plyrReady;
    /** @type {?} */
    PlyrComponent.prototype.plyrLoadStart;
    /** @type {?} */
    PlyrComponent.prototype.plyrLoadedData;
    /** @type {?} */
    PlyrComponent.prototype.plyrLoadedMetadata;
    /** @type {?} */
    PlyrComponent.prototype.plyrQualityChange;
    /** @type {?} */
    PlyrComponent.prototype.plyrCanPlay;
    /** @type {?} */
    PlyrComponent.prototype.plyrCanPlayThrough;
    /** @type {?} */
    PlyrComponent.prototype.plyrStalled;
    /** @type {?} */
    PlyrComponent.prototype.plyrWaiting;
    /** @type {?} */
    PlyrComponent.prototype.plyrEmptied;
    /** @type {?} */
    PlyrComponent.prototype.plyrCueChange;
    /** @type {?} */
    PlyrComponent.prototype.plyrError;
    /** @type {?} */
    PlyrComponent.prototype.plyrStateChange;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.driver;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.videoElement;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    PlyrComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx5ci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGx5ci8iLCJzb3VyY2VzIjpbImxpYi9wbHlyL3BseXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBRSxVQUFVLEVBQWdCLEtBQUssRUFBRSxNQUFNLEVBQXdCLE1BQU0sRUFBRSxTQUFTLEVBQStCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuTCxPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDOzs7O0FBR3ZFLGdDQU9DOzs7SUFOQyxxQ0FBdUI7O0lBQ3ZCLHNDQUF3Qjs7SUFDeEIsdUNBQXlCOztJQUN6Qix3Q0FBMEI7O0lBQzFCLHVDQUF5Qjs7SUFDekIsd0NBQTBCOztBQUc1QjtJQTZFRSx1QkFDVSxVQUFzQyxFQUN0QyxNQUFjLEVBQ2QsUUFBbUI7UUFGbkIsZUFBVSxHQUFWLFVBQVUsQ0FBNEI7UUFDdEMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLGFBQVEsR0FBUixRQUFRLENBQVc7UUF4RXJCLGlCQUFZLEdBQUcsSUFBSSxlQUFlLENBQU8sSUFBSSxDQUFDLENBQUM7UUFNL0MsV0FBTSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFJVixhQUFRLEdBQW1CLE9BQU8sQ0FBQzs7UUFlMUMsYUFBUSxHQUFHLG1CQUFBLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLENBQUMsQ0FBQyxNQUFNLEVBQVIsQ0FBUSxDQUFDLENBQUMsRUFBc0IsQ0FBQzs7UUFH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OzhCQUNOLE1BQU07OEJBQ04sTUFBTTs4QkFDTixNQUFNO2dDQUNOLE1BQU07NEJBQ04sTUFBTTtrQ0FHTixNQUFNOztJQXdIVCxvQkFBQztDQUFBLEFBN0xELElBNkxDO1NBdkxZLGFBQWE7Ozs7OztJQUV4QixxQ0FBdUQ7Ozs7O0lBTXZELCtCQUEyQjs7Ozs7SUFFM0IsbUNBQXdDOzs7OztJQUV4QyxpQ0FBb0Q7Ozs7O0lBRXBELGtDQUFtQzs7Ozs7SUFFbkMsbUNBQW9DOzs7OztJQUVwQyxvQ0FBNEM7Ozs7O0lBRTVDLG1DQUEwQzs7Ozs7SUFFMUMsb0NBQTJDOzs7OztJQUUzQywyQkFBdUM7O0lBR3ZDLGlDQUE4Rjs7SUFHOUYscUNBQTBEOztJQUMxRCxvQ0FBd0Q7O0lBQ3hELGlDQUFrRDs7SUFDbEQsa0NBQW9EOztJQUNwRCx1Q0FBOEQ7O0lBQzlELHlDQUFrRTs7SUFDbEUsb0NBQXdEOztJQUN4RCxtQ0FBc0Q7O0lBQ3RELHVDQUE4RDs7SUFDOUQsa0NBQW9EOztJQUNwRCw0Q0FBd0U7O0lBQ3hFLDJDQUFzRTs7SUFDdEUsNENBQXdFOztJQUN4RSw2Q0FBMEU7O0lBQzFFLDJDQUFzRTs7SUFDdEUsMkNBQXNFOztJQUN0RSwwQ0FBb0U7O0lBQ3BFLGtDQUFvRDs7SUFHcEQsc0NBQTREOztJQUM1RCx1Q0FBOEQ7O0lBQzlELDJDQUFzRTs7SUFDdEUsMENBQW9FOztJQUNwRSxvQ0FBd0Q7O0lBQ3hELDJDQUFzRTs7SUFDdEUsb0NBQXdEOztJQUN4RCxvQ0FBd0Q7O0lBQ3hELG9DQUF3RDs7SUFDeEQsc0NBQTREOztJQUM1RCxrQ0FBb0Q7O0lBR3BELHdDQUFnRTs7Ozs7SUFFaEUsc0NBQTJDOzs7OztJQUUzQywrQkFBMkI7Ozs7O0lBRTNCLHFDQUF1Qzs7Ozs7SUFHckMsbUNBQThDOzs7OztJQUM5QywrQkFBc0I7Ozs7O0lBQ3RCLGlDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgTmdab25lLCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT3V0cHV0LCBSZW5kZXJlcjIsIFNpbXBsZUNoYW5nZSwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgUGx5ciBmcm9tICdwbHlyJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIGZpcnN0LCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEZWZhdWx0UGx5ckRyaXZlciB9IGZyb20gJy4uL3BseXItZHJpdmVyL2RlZmF1bHQtcGx5ci1kcml2ZXInO1xuaW1wb3J0IHsgUGx5ckRyaXZlciB9IGZyb20gJy4uL3BseXItZHJpdmVyL3BseXItZHJpdmVyJztcblxuaW50ZXJmYWNlIFBseXJTaW1wbGVDaGFuZ2VzIGV4dGVuZHMgU2ltcGxlQ2hhbmdlcyB7XG4gIHBseXJUeXBlOiBTaW1wbGVDaGFuZ2U7XG4gIHBseXJUaXRsZTogU2ltcGxlQ2hhbmdlO1xuICBwbHlyUG9zdGVyOiBTaW1wbGVDaGFuZ2U7XG4gIHBseXJTb3VyY2VzOiBTaW1wbGVDaGFuZ2U7XG4gIHBseXJUcmFja3M6IFNpbXBsZUNoYW5nZTtcbiAgcGx5ck9wdGlvbnM6IFNpbXBsZUNoYW5nZTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncGx5ciwgW3BseXJdJywgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZVVybDogJy4vcGx5ci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3BseXIuY29tcG9uZW50LmNzcyddLFxuICBleHBvcnRBczogJ3BseXInXG59KVxuZXhwb3J0IGNsYXNzIFBseXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cbiAgcHJpdmF0ZSBwbGF5ZXJDaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFBseXI+KG51bGwpO1xuXG4gIGdldCBwbGF5ZXIoKTogUGx5ciB7XG4gICAgcmV0dXJuIHRoaXMucGxheWVyQ2hhbmdlLmdldFZhbHVlKCk7XG4gIH1cblxuICBwcml2YXRlIGV2ZW50cyA9IG5ldyBNYXAoKTtcblxuICBASW5wdXQoKSBwcml2YXRlIHBseXJEcml2ZXI6IFBseXJEcml2ZXI7XG5cbiAgQElucHV0KCkgcHJpdmF0ZSBwbHlyVHlwZTogUGx5ci5NZWRpYVR5cGUgPSAndmlkZW8nO1xuXG4gIEBJbnB1dCgpIHByaXZhdGUgcGx5clRpdGxlOiBzdHJpbmc7XG5cbiAgQElucHV0KCkgcHJpdmF0ZSBwbHlyUG9zdGVyOiBzdHJpbmc7XG5cbiAgQElucHV0KCkgcHJpdmF0ZSBwbHlyU291cmNlczogUGx5ci5Tb3VyY2VbXTtcblxuICBASW5wdXQoKSBwcml2YXRlIHBseXJUcmFja3M6IFBseXIuVHJhY2tbXTtcblxuICBASW5wdXQoKSBwcml2YXRlIHBseXJPcHRpb25zOiBQbHlyLk9wdGlvbnM7XG5cbiAgQFZpZXdDaGlsZCgndicpIHByaXZhdGUgdnI6IEVsZW1lbnRSZWY7XG5cbiAgLy8gbmd4LXBseXIgZXZlbnRzXG4gIEBPdXRwdXQoKSBwbHlySW5pdCA9IHRoaXMucGxheWVyQ2hhbmdlLnBpcGUoZmlsdGVyKHBsYXllciA9PiAhIXBsYXllcikpIGFzIEV2ZW50RW1pdHRlcjxQbHlyPjtcblxuICAvLyBzdGFuZGFyZCBtZWRpYSBldmVudHNcbiAgQE91dHB1dCgpIHBseXJQcm9ncmVzcyA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdwcm9ncmVzcycpO1xuICBAT3V0cHV0KCkgcGx5clBsYXlpbmcgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgncGxheWluZycpO1xuICBAT3V0cHV0KCkgcGx5clBsYXkgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgncGxheScpO1xuICBAT3V0cHV0KCkgcGx5clBhdXNlID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3BhdXNlJyk7XG4gIEBPdXRwdXQoKSBwbHlyVGltZVVwZGF0ZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCd0aW1ldXBkYXRlJyk7XG4gIEBPdXRwdXQoKSBwbHlyVm9sdW1lQ2hhbmdlID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3ZvbHVtZWNoYW5nZScpO1xuICBAT3V0cHV0KCkgcGx5clNlZWtpbmcgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnc2Vla2luZycpO1xuICBAT3V0cHV0KCkgcGx5clNlZWtlZCA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdzZWVrZWQnKTtcbiAgQE91dHB1dCgpIHBseXJSYXRlQ2hhbmdlID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3JhdGVjaGFuZ2UnKTtcbiAgQE91dHB1dCgpIHBseXJFbmRlZCA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdlbmRlZCcpO1xuICBAT3V0cHV0KCkgcGx5ckVudGVyRnVsbFNjcmVlbiA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdlbnRlcmZ1bGxzY3JlZW4nKTtcbiAgQE91dHB1dCgpIHBseXJFeGl0RnVsbFNjcmVlbiA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdleGl0ZnVsbHNjcmVlbicpO1xuICBAT3V0cHV0KCkgcGx5ckNhcHRpb25zRW5hYmxlZCA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjYXB0aW9uc2VuYWJsZWQnKTtcbiAgQE91dHB1dCgpIHBseXJDYXB0aW9uc0Rpc2FibGVkID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2NhcHRpb25zZGlzYWJsZWQnKTtcbiAgQE91dHB1dCgpIHBseXJMYW5ndWFnZUNoYW5nZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdsYW5ndWFnZWNoYW5nZScpO1xuICBAT3V0cHV0KCkgcGx5ckNvbnRyb2xzSGlkZGVuID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2NvbnRyb2xzaGlkZGVuJyk7XG4gIEBPdXRwdXQoKSBwbHlyQ29udHJvbHNTaG93biA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjb250cm9sc3Nob3duJyk7XG4gIEBPdXRwdXQoKSBwbHlyUmVhZHkgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgncmVhZHknKTtcblxuICAvLyBIVE1MNSBldmVudHNcbiAgQE91dHB1dCgpIHBseXJMb2FkU3RhcnQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnbG9hZHN0YXJ0Jyk7XG4gIEBPdXRwdXQoKSBwbHlyTG9hZGVkRGF0YSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdsb2FkZWRkYXRhJyk7XG4gIEBPdXRwdXQoKSBwbHlyTG9hZGVkTWV0YWRhdGEgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnbG9hZGVkbWV0YWRhdGEnKTtcbiAgQE91dHB1dCgpIHBseXJRdWFsaXR5Q2hhbmdlID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3F1YWxpdHljaGFuZ2UnKTtcbiAgQE91dHB1dCgpIHBseXJDYW5QbGF5ID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2NhbnBsYXknKTtcbiAgQE91dHB1dCgpIHBseXJDYW5QbGF5VGhyb3VnaCA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjYW5wbGF5dGhyb3VnaCcpO1xuICBAT3V0cHV0KCkgcGx5clN0YWxsZWQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnc3RhbGxlZCcpO1xuICBAT3V0cHV0KCkgcGx5cldhaXRpbmcgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnd2FpdGluZycpO1xuICBAT3V0cHV0KCkgcGx5ckVtcHRpZWQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnZW1wdGllZCcpO1xuICBAT3V0cHV0KCkgcGx5ckN1ZUNoYW5nZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjdWVjaGFuZ2UnKTtcbiAgQE91dHB1dCgpIHBseXJFcnJvciA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdlcnJvcicpO1xuXG4gIC8vIFlvdVR1YmUgZXZlbnRzXG4gIEBPdXRwdXQoKSBwbHlyU3RhdGVDaGFuZ2UgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnc3RhdGVjaGFuZ2UnKTtcblxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgcHJpdmF0ZSBkcml2ZXI6IFBseXJEcml2ZXI7XG5cbiAgcHJpdmF0ZSB2aWRlb0VsZW1lbnQ6IEhUTUxWaWRlb0VsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxEaXZFbGVtZW50PixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgKSB7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBQbHlyU2ltcGxlQ2hhbmdlcykge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMucGx5ckluaXQucGlwZShmaXJzdCgpKS5zdWJzY3JpYmUoKHBsYXllcjogUGx5cikgPT4ge1xuICAgICAgaWYgKGNoYW5nZXMucGx5ck9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFjaGFuZ2VzLnBseXJPcHRpb25zLmZpcnN0Q2hhbmdlKSB7XG4gICAgICAgICAgdGhpcy5pbml0UGx5cih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy51cGRhdGVQbHlyU291cmNlKHBsYXllcik7XG4gICAgICB9XG4gICAgfSkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kZXN0cm95UGxheWVyKCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2gocyA9PiBzLnVuc3Vic2NyaWJlKCkpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdFBseXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFBseXIoZm9yY2UgPSBmYWxzZSkge1xuICAgIGlmIChmb3JjZSB8fCAhdGhpcy5wbGF5ZXIpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5kZXN0cm95UGxheWVyKCk7XG5cbiAgICAgICAgdGhpcy5kcml2ZXIgPSB0aGlzLnBseXJEcml2ZXIgfHwgbmV3IERlZmF1bHRQbHlyRHJpdmVyKCk7XG5cbiAgICAgICAgdGhpcy5lbnN1cmVWaWRlb0VsZW1lbnQoKTtcblxuICAgICAgICBjb25zdCBuZXdQbGF5ZXIgPSB0aGlzLmRyaXZlci5jcmVhdGUoe1xuICAgICAgICAgIHZpZGVvRWxlbWVudDogdGhpcy52aWRlb0VsZW1lbnQsXG4gICAgICAgICAgb3B0aW9uczogdGhpcy5wbHlyT3B0aW9ucyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVQbHlyU291cmNlKG5ld1BsYXllcik7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXJDaGFuZ2UubmV4dChuZXdQbGF5ZXIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQbHlyU291cmNlKHBseXI6IFBseXIpIHtcbiAgICB0aGlzLmRyaXZlci51cGRhdGVTb3VyY2Uoe1xuICAgICAgdmlkZW9FbGVtZW50OiB0aGlzLnZpZGVvRWxlbWVudCxcbiAgICAgIHBseXIsXG4gICAgICBzb3VyY2U6IHtcbiAgICAgICAgdHlwZTogdGhpcy5wbHlyVHlwZSxcbiAgICAgICAgdGl0bGU6IHRoaXMucGx5clRpdGxlLFxuICAgICAgICBzb3VyY2VzOiB0aGlzLnBseXJTb3VyY2VzLFxuICAgICAgICBwb3N0ZXI6IHRoaXMucGx5clBvc3RlcixcbiAgICAgICAgdHJhY2tzOiB0aGlzLnBseXJUcmFja3MsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLy8gc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS81MzcwNDEwMi8xOTkwNDUxXG4gIHByaXZhdGUgY3JlYXRlTGF6eUV2ZW50PFQgZXh0ZW5kcyBQbHlyLlBseXJFdmVudD4obmFtZTogUGx5ci5TdGFuZGFyZEV2ZW50IHwgUGx5ci5IdG1sNUV2ZW50IHwgUGx5ci5Zb3V0dWJlRXZlbnQpOiBFdmVudEVtaXR0ZXI8VD4ge1xuICAgIHJldHVybiB0aGlzLnBseXJJbml0LnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4gdGhpcy5vbihuYW1lLCAoZGF0YTogVCkgPT4gdGhpcy5uZ1pvbmUucnVuKCgpID0+IG9ic2VydmVyLm5leHQoZGF0YSkpKSkpXG4gICAgKSBhcyBFdmVudEVtaXR0ZXI8VD47XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lQbGF5ZXIoKSB7XG4gICAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgICBBcnJheS5mcm9tKHRoaXMuZXZlbnRzLmtleXMoKSkuZm9yRWFjaChuYW1lID0+IHRoaXMub2ZmKG5hbWUpKTtcblxuICAgICAgdGhpcy5kcml2ZXIuZGVzdHJveSh7XG4gICAgICAgIHBseXI6IHRoaXMucGxheWVyLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudmlkZW9FbGVtZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldCBob3N0RWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICAvLyB0aGlzIG1ldGhvZCBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBwbHlyIGluc2VydHMgY2xvbmUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQgb24gZGVzdHJveVxuICAvLyBzbyB3ZSBjYXRjaCB0aGUgY2xvbmUgZWxlbWVudCByaWdodCBoZXJlIGFuZCByZXVzZSBpdFxuICBwcml2YXRlIGVuc3VyZVZpZGVvRWxlbWVudCgpIHtcbiAgICBjb25zdCB2aWRlb0VsZW1lbnQgPSB0aGlzLmhvc3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJyk7XG5cbiAgICBpZiAodmlkZW9FbGVtZW50KSB7XG4gICAgICB0aGlzLnZpZGVvRWxlbWVudCA9IHZpZGVvRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aWRlb0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG4gICAgICB0aGlzLnZpZGVvRWxlbWVudC5jb250cm9scyA9IHRydWU7XG4gICAgICB0aGlzLnZpZGVvRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Nyb3Nzb3JpZ2luJywgJycpO1xuICAgICAgdGhpcy52aWRlb0VsZW1lbnQuc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5ob3N0RWxlbWVudCwgdGhpcy52aWRlb0VsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb24obmFtZTogc3RyaW5nLCBoYW5kbGVyOiBhbnkpIHtcbiAgICB0aGlzLmV2ZW50cy5zZXQobmFtZSwgaGFuZGxlcik7XG4gICAgdGhpcy5wbGF5ZXIub24obmFtZSBhcyBhbnksIGhhbmRsZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBvZmYobmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5wbGF5ZXIub2ZmKG5hbWUgYXMgYW55LCB0aGlzLmV2ZW50cy5nZXQobmFtZSkpO1xuICAgIHRoaXMuZXZlbnRzLmRlbGV0ZShuYW1lKTtcbiAgfVxuXG59XG4iXX0=