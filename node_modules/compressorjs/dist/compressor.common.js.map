{"version":3,"file":"compressor.common.js","sources":["../node_modules/blueimp-canvas-to-blob/js/canvas-to-blob.js","../node_modules/is-blob/index.js","../src/defaults.js","../src/constants.js","../src/utilities.js","../src/index.js"],"sourcesContent":["/*\n * JavaScript Canvas to Blob\n * https://github.com/blueimp/JavaScript-Canvas-to-Blob\n *\n * Copyright 2012, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on stackoverflow user Stoive's code snippet:\n * http://stackoverflow.com/q/4998908\n */\n\n/* global define, Uint8Array, ArrayBuffer, module */\n\n;(function(window) {\n  'use strict'\n\n  var CanvasPrototype =\n    window.HTMLCanvasElement && window.HTMLCanvasElement.prototype\n  var hasBlobConstructor =\n    window.Blob &&\n    (function() {\n      try {\n        return Boolean(new Blob())\n      } catch (e) {\n        return false\n      }\n    })()\n  var hasArrayBufferViewSupport =\n    hasBlobConstructor &&\n    window.Uint8Array &&\n    (function() {\n      try {\n        return new Blob([new Uint8Array(100)]).size === 100\n      } catch (e) {\n        return false\n      }\n    })()\n  var BlobBuilder =\n    window.BlobBuilder ||\n    window.WebKitBlobBuilder ||\n    window.MozBlobBuilder ||\n    window.MSBlobBuilder\n  var dataURIPattern = /^data:((.*?)(;charset=.*?)?)(;base64)?,/\n  var dataURLtoBlob =\n    (hasBlobConstructor || BlobBuilder) &&\n    window.atob &&\n    window.ArrayBuffer &&\n    window.Uint8Array &&\n    function(dataURI) {\n      var matches,\n        mediaType,\n        isBase64,\n        dataString,\n        byteString,\n        arrayBuffer,\n        intArray,\n        i,\n        bb\n      // Parse the dataURI components as per RFC 2397\n      matches = dataURI.match(dataURIPattern)\n      if (!matches) {\n        throw new Error('invalid data URI')\n      }\n      // Default to text/plain;charset=US-ASCII\n      mediaType = matches[2]\n        ? matches[1]\n        : 'text/plain' + (matches[3] || ';charset=US-ASCII')\n      isBase64 = !!matches[4]\n      dataString = dataURI.slice(matches[0].length)\n      if (isBase64) {\n        // Convert base64 to raw binary data held in a string:\n        byteString = atob(dataString)\n      } else {\n        // Convert base64/URLEncoded data component to raw binary:\n        byteString = decodeURIComponent(dataString)\n      }\n      // Write the bytes of the string to an ArrayBuffer:\n      arrayBuffer = new ArrayBuffer(byteString.length)\n      intArray = new Uint8Array(arrayBuffer)\n      for (i = 0; i < byteString.length; i += 1) {\n        intArray[i] = byteString.charCodeAt(i)\n      }\n      // Write the ArrayBuffer (or ArrayBufferView) to a blob:\n      if (hasBlobConstructor) {\n        return new Blob([hasArrayBufferViewSupport ? intArray : arrayBuffer], {\n          type: mediaType\n        })\n      }\n      bb = new BlobBuilder()\n      bb.append(arrayBuffer)\n      return bb.getBlob(mediaType)\n    }\n  if (window.HTMLCanvasElement && !CanvasPrototype.toBlob) {\n    if (CanvasPrototype.mozGetAsFile) {\n      CanvasPrototype.toBlob = function(callback, type, quality) {\n        var self = this\n        setTimeout(function() {\n          if (quality && CanvasPrototype.toDataURL && dataURLtoBlob) {\n            callback(dataURLtoBlob(self.toDataURL(type, quality)))\n          } else {\n            callback(self.mozGetAsFile('blob', type))\n          }\n        })\n      }\n    } else if (CanvasPrototype.toDataURL && dataURLtoBlob) {\n      CanvasPrototype.toBlob = function(callback, type, quality) {\n        var self = this\n        setTimeout(function() {\n          callback(dataURLtoBlob(self.toDataURL(type, quality)))\n        })\n      }\n    }\n  }\n  if (typeof define === 'function' && define.amd) {\n    define(function() {\n      return dataURLtoBlob\n    })\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = dataURLtoBlob\n  } else {\n    window.dataURLtoBlob = dataURLtoBlob\n  }\n})(window)\n","'use strict';\n\nmodule.exports = input => {\n\tif (typeof Blob === 'undefined') {\n\t\treturn false;\n\t}\n\n\treturn input instanceof Blob || Object.prototype.toString.call(input) === '[object Blob]';\n};\n","export default {\n  /**\n   * Indicates if output the original image instead of the compressed one\n   * when the size of the compressed image is greater than the original one's\n   * @type {boolean}\n   */\n  strict: true,\n\n  /**\n   * Indicates if read the image's Exif Orientation information,\n   * and then rotate or flip the image automatically.\n   * @type {boolean}\n   */\n  checkOrientation: true,\n\n  /**\n   * The max width of the output image.\n   * @type {number}\n   */\n  maxWidth: Infinity,\n\n  /**\n   * The max height of the output image.\n   * @type {number}\n   */\n  maxHeight: Infinity,\n\n  /**\n   * The min width of the output image.\n   * @type {number}\n   */\n  minWidth: 0,\n\n  /**\n   * The min height of the output image.\n   * @type {number}\n   */\n  minHeight: 0,\n\n  /**\n   * The width of the output image.\n   * If not specified, the natural width of the source image will be used.\n   * @type {number}\n   */\n  width: undefined,\n\n  /**\n   * The height of the output image.\n   * If not specified, the natural height of the source image will be used.\n   * @type {number}\n   */\n  height: undefined,\n\n  /**\n   * The quality of the output image.\n   * It must be a number between `0` and `1`,\n   * and only available for `image/jpeg` and `image/webp` images.\n   * Check out {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob canvas.toBlob}.\n   * @type {number}\n   */\n  quality: 0.8,\n\n  /**\n   * The mime type of the output image.\n   * By default, the original mime type of the source image file will be used.\n   * @type {string}\n   */\n  mimeType: 'auto',\n\n  /**\n   * PNG files over this value (5 MB by default) will be converted to JPEGs.\n   * To disable this, just set the value to `Infinity`.\n   * @type {number}\n   */\n  convertSize: 5000000,\n\n  /**\n   * The hook function to execute before draw the image into the canvas for compression.\n   * @type {Function}\n   * @param {CanvasRenderingContext2D} context - The 2d rendering context of the canvas.\n   * @param {HTMLCanvasElement} canvas - The canvas for compression.\n   * @example\n   * function (context, canvas) {\n   *   context.fillStyle = '#fff';\n   * }\n   */\n  beforeDraw: null,\n\n  /**\n   * The hook function to execute after drew the image into the canvas for compression.\n   * @type {Function}\n   * @param {CanvasRenderingContext2D} context - The 2d rendering context of the canvas.\n   * @param {HTMLCanvasElement} canvas - The canvas for compression.\n   * @example\n   * function (context, canvas) {\n   *   context.filter = 'grayscale(100%)';\n   * }\n   */\n  drew: null,\n\n  /**\n   * The hook function to execute when success to compress the image.\n   * @type {Function}\n   * @param {File} file - The compressed image File object.\n   * @example\n   * function (file) {\n   *   console.log(file);\n   * }\n   */\n  success: null,\n\n  /**\n   * The hook function to execute when fail to compress the image.\n   * @type {Function}\n   * @param {Error} err - An Error object.\n   * @example\n   * function (err) {\n   *   console.log(err.message);\n   * }\n   */\n  error: null,\n};\n","export const IS_BROWSER = typeof window !== 'undefined' && typeof window.document !== 'undefined';\nexport const WINDOW = IS_BROWSER ? window : {};\n","import {\n  WINDOW,\n} from './constants';\n\nconst { slice } = Array.prototype;\n\n/**\n * Convert array-like or iterable object to an array.\n * @param {*} value - The value to convert.\n * @returns {Array} Returns a new array.\n */\nexport function toArray(value) {\n  return Array.from ? Array.from(value) : slice.call(value);\n}\n\nconst REGEXP_IMAGE_TYPE = /^image\\/.+$/;\n\n/**\n * Check if the given value is a mime type of image.\n * @param {*} value - The value to check.\n * @returns {boolean} Returns `true` if the given is a mime type of image, else `false`.\n */\nexport function isImageType(value) {\n  return REGEXP_IMAGE_TYPE.test(value);\n}\n\n/**\n * Convert image type to extension.\n * @param {string} value - The image type to convert.\n * @returns {boolean} Returns the image extension.\n */\nexport function imageTypeToExtension(value) {\n  let extension = isImageType(value) ? value.substr(6) : '';\n\n  if (extension === 'jpeg') {\n    extension = 'jpg';\n  }\n\n  return `.${extension}`;\n}\n\nconst { fromCharCode } = String;\n\n/**\n * Get string from char code in data view.\n * @param {DataView} dataView - The data view for read.\n * @param {number} start - The start index.\n * @param {number} length - The read length.\n * @returns {string} The read result.\n */\nexport function getStringFromCharCode(dataView, start, length) {\n  let str = '';\n  let i;\n\n  length += start;\n\n  for (i = start; i < length; i += 1) {\n    str += fromCharCode(dataView.getUint8(i));\n  }\n\n  return str;\n}\n\nconst { btoa } = WINDOW;\n\n/**\n * Transform array buffer to Data URL.\n * @param {ArrayBuffer} arrayBuffer - The array buffer to transform.\n * @param {string} mimeType - The mime type of the Data URL.\n * @returns {string} The result Data URL.\n */\nexport function arrayBufferToDataURL(arrayBuffer, mimeType) {\n  const chunks = [];\n  const chunkSize = 8192;\n  let uint8 = new Uint8Array(arrayBuffer);\n\n  while (uint8.length > 0) {\n    // XXX: Babel's `toConsumableArray` helper will throw error in IE or Safari 9\n    // eslint-disable-next-line prefer-spread\n    chunks.push(fromCharCode.apply(null, toArray(uint8.subarray(0, chunkSize))));\n    uint8 = uint8.subarray(chunkSize);\n  }\n\n  return `data:${mimeType};base64,${btoa(chunks.join(''))}`;\n}\n\n/**\n * Get orientation value from given array buffer.\n * @param {ArrayBuffer} arrayBuffer - The array buffer to read.\n * @returns {number} The read orientation value.\n */\nexport function resetAndGetOrientation(arrayBuffer) {\n  const dataView = new DataView(arrayBuffer);\n  let orientation;\n\n  // Ignores range error when the image does not have correct Exif information\n  try {\n    let littleEndian;\n    let app1Start;\n    let ifdStart;\n\n    // Only handle JPEG image (start by 0xFFD8)\n    if (dataView.getUint8(0) === 0xFF && dataView.getUint8(1) === 0xD8) {\n      const length = dataView.byteLength;\n      let offset = 2;\n\n      while (offset + 1 < length) {\n        if (dataView.getUint8(offset) === 0xFF && dataView.getUint8(offset + 1) === 0xE1) {\n          app1Start = offset;\n          break;\n        }\n\n        offset += 1;\n      }\n    }\n\n    if (app1Start) {\n      const exifIDCode = app1Start + 4;\n      const tiffOffset = app1Start + 10;\n\n      if (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {\n        const endianness = dataView.getUint16(tiffOffset);\n\n        littleEndian = endianness === 0x4949;\n\n        if (littleEndian || endianness === 0x4D4D /* bigEndian */) {\n          if (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002A) {\n            const firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);\n\n            if (firstIFDOffset >= 0x00000008) {\n              ifdStart = tiffOffset + firstIFDOffset;\n            }\n          }\n        }\n      }\n    }\n\n    if (ifdStart) {\n      const length = dataView.getUint16(ifdStart, littleEndian);\n      let offset;\n      let i;\n\n      for (i = 0; i < length; i += 1) {\n        offset = ifdStart + (i * 12) + 2;\n\n        if (dataView.getUint16(offset, littleEndian) === 0x0112 /* Orientation */) {\n          // 8 is the offset of the current tag's value\n          offset += 8;\n\n          // Get the original orientation value\n          orientation = dataView.getUint16(offset, littleEndian);\n\n          // Override the orientation with its default value\n          dataView.setUint16(offset, 1, littleEndian);\n          break;\n        }\n      }\n    }\n  } catch (e) {\n    orientation = 1;\n  }\n\n  return orientation;\n}\n\n/**\n * Parse Exif Orientation value.\n * @param {number} orientation - The orientation to parse.\n * @returns {Object} The parsed result.\n */\nexport function parseOrientation(orientation) {\n  let rotate = 0;\n  let scaleX = 1;\n  let scaleY = 1;\n\n  switch (orientation) {\n    // Flip horizontal\n    case 2:\n      scaleX = -1;\n      break;\n\n    // Rotate left 180°\n    case 3:\n      rotate = -180;\n      break;\n\n    // Flip vertical\n    case 4:\n      scaleY = -1;\n      break;\n\n    // Flip vertical and rotate right 90°\n    case 5:\n      rotate = 90;\n      scaleY = -1;\n      break;\n\n    // Rotate right 90°\n    case 6:\n      rotate = 90;\n      break;\n\n    // Flip horizontal and rotate right 90°\n    case 7:\n      rotate = 90;\n      scaleX = -1;\n      break;\n\n    // Rotate left 90°\n    case 8:\n      rotate = -90;\n      break;\n\n    default:\n  }\n\n  return {\n    rotate,\n    scaleX,\n    scaleY,\n  };\n}\n\nconst REGEXP_DECIMALS = /\\.\\d*(?:0|9){12}\\d*$/;\n\n/**\n * Normalize decimal number.\n * Check out {@link https://0.30000000000000004.com/}\n * @param {number} value - The value to normalize.\n * @param {number} [times=100000000000] - The times for normalizing.\n * @returns {number} Returns the normalized number.\n */\nexport function normalizeDecimalNumber(value, times = 100000000000) {\n  return REGEXP_DECIMALS.test(value) ? (Math.round(value * times) / times) : value;\n}\n","import toBlob from 'blueimp-canvas-to-blob';\nimport isBlob from 'is-blob';\nimport DEFAULTS from './defaults';\nimport {\n  WINDOW,\n} from './constants';\nimport {\n  arrayBufferToDataURL,\n  imageTypeToExtension,\n  isImageType,\n  normalizeDecimalNumber,\n  parseOrientation,\n  resetAndGetOrientation,\n} from './utilities';\n\nconst { ArrayBuffer, FileReader } = WINDOW;\nconst URL = WINDOW.URL || WINDOW.webkitURL;\nconst REGEXP_EXTENSION = /\\.\\w+$/;\nconst AnotherCompressor = WINDOW.Compressor;\n\n/**\n * Creates a new image compressor.\n * @class\n */\nexport default class Compressor {\n  /**\n   * The constructor of Compressor.\n   * @param {File|Blob} file - The target image file for compressing.\n   * @param {Object} [options] - The options for compressing.\n   */\n  constructor(file, options) {\n    this.file = file;\n    this.image = new Image();\n    this.options = {\n      ...DEFAULTS,\n      ...options,\n    };\n    this.aborted = false;\n    this.result = null;\n    this.init();\n  }\n\n  init() {\n    const { file, options } = this;\n\n    if (!isBlob(file)) {\n      this.fail(new Error('The first argument must be a File or Blob object.'));\n      return;\n    }\n\n    const mimeType = file.type;\n\n    if (!isImageType(mimeType)) {\n      this.fail(new Error('The first argument must be an image File or Blob object.'));\n      return;\n    }\n\n    if (!URL || !FileReader) {\n      this.fail(new Error('The current browser does not support image compression.'));\n      return;\n    }\n\n    if (!ArrayBuffer) {\n      options.checkOrientation = false;\n    }\n\n    if (URL && !options.checkOrientation) {\n      this.load({\n        url: URL.createObjectURL(file),\n      });\n    } else {\n      const reader = new FileReader();\n      const checkOrientation = options.checkOrientation && mimeType === 'image/jpeg';\n\n      this.reader = reader;\n      reader.onload = ({ target }) => {\n        const { result } = target;\n        const data = {};\n\n        if (checkOrientation) {\n          // Reset the orientation value to its default value 1\n          // as some iOS browsers will render image with its orientation\n          const orientation = resetAndGetOrientation(result);\n\n          if (orientation > 1 || !URL) {\n            // Generate a new URL which has the default orientation value\n            data.url = arrayBufferToDataURL(result, mimeType);\n\n            if (orientation > 1) {\n              Object.assign(data, parseOrientation(orientation));\n            }\n          } else {\n            data.url = URL.createObjectURL(file);\n          }\n        } else {\n          data.url = result;\n        }\n\n        this.load(data);\n      };\n      reader.onabort = () => {\n        this.fail(new Error('Aborted to read the image with FileReader.'));\n      };\n      reader.onerror = () => {\n        this.fail(new Error('Failed to read the image with FileReader.'));\n      };\n      reader.onloadend = () => {\n        this.reader = null;\n      };\n\n      if (checkOrientation) {\n        reader.readAsArrayBuffer(file);\n      } else {\n        reader.readAsDataURL(file);\n      }\n    }\n  }\n\n  load(data) {\n    const { file, image } = this;\n\n    image.onload = () => {\n      this.draw({\n        ...data,\n        naturalWidth: image.naturalWidth,\n        naturalHeight: image.naturalHeight,\n      });\n    };\n    image.onabort = () => {\n      this.fail(new Error('Aborted to load the image.'));\n    };\n    image.onerror = () => {\n      this.fail(new Error('Failed to load the image.'));\n    };\n\n    // Match all browsers that use WebKit as the layout engine in iOS devices,\n    // such as Safari for iOS, Chrome for iOS, and in-app browsers.\n    if (WINDOW.navigator && /(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent)) {\n      // Fix the `The operation is insecure` error (#57)\n      image.crossOrigin = 'anonymous';\n    }\n\n    image.alt = file.name;\n    image.src = data.url;\n  }\n\n  draw({\n    naturalWidth,\n    naturalHeight,\n    rotate = 0,\n    scaleX = 1,\n    scaleY = 1,\n  }) {\n    const { file, image, options } = this;\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    const aspectRatio = naturalWidth / naturalHeight;\n    const is90DegreesRotated = Math.abs(rotate) % 180 === 90;\n    let maxWidth = Math.max(options.maxWidth, 0) || Infinity;\n    let maxHeight = Math.max(options.maxHeight, 0) || Infinity;\n    let minWidth = Math.max(options.minWidth, 0) || 0;\n    let minHeight = Math.max(options.minHeight, 0) || 0;\n    let width = Math.max(options.width, 0) || naturalWidth;\n    let height = Math.max(options.height, 0) || naturalHeight;\n\n    if (is90DegreesRotated) {\n      [maxWidth, maxHeight] = [maxHeight, maxWidth];\n      [minWidth, minHeight] = [minHeight, minWidth];\n      [width, height] = [height, width];\n    }\n\n    if (maxWidth < Infinity && maxHeight < Infinity) {\n      if (maxHeight * aspectRatio > maxWidth) {\n        maxHeight = maxWidth / aspectRatio;\n      } else {\n        maxWidth = maxHeight * aspectRatio;\n      }\n    } else if (maxWidth < Infinity) {\n      maxHeight = maxWidth / aspectRatio;\n    } else if (maxHeight < Infinity) {\n      maxWidth = maxHeight * aspectRatio;\n    }\n\n    if (minWidth > 0 && minHeight > 0) {\n      if (minHeight * aspectRatio > minWidth) {\n        minHeight = minWidth / aspectRatio;\n      } else {\n        minWidth = minHeight * aspectRatio;\n      }\n    } else if (minWidth > 0) {\n      minHeight = minWidth / aspectRatio;\n    } else if (minHeight > 0) {\n      minWidth = minHeight * aspectRatio;\n    }\n\n    if (height * aspectRatio > width) {\n      height = width / aspectRatio;\n    } else {\n      width = height * aspectRatio;\n    }\n\n    width = Math.floor(normalizeDecimalNumber(Math.min(Math.max(width, minWidth), maxWidth)));\n    height = Math.floor(normalizeDecimalNumber(Math.min(Math.max(height, minHeight), maxHeight)));\n\n    const destX = -width / 2;\n    const destY = -height / 2;\n    const destWidth = width;\n    const destHeight = height;\n\n    if (is90DegreesRotated) {\n      [width, height] = [height, width];\n    }\n\n    canvas.width = width;\n    canvas.height = height;\n\n    if (!isImageType(options.mimeType)) {\n      options.mimeType = file.type;\n    }\n\n    let fillStyle = 'transparent';\n\n    // Converts PNG files over the `convertSize` to JPEGs.\n    if (file.size > options.convertSize && options.mimeType === 'image/png') {\n      fillStyle = '#fff';\n      options.mimeType = 'image/jpeg';\n    }\n\n    // Override the default fill color (#000, black)\n    context.fillStyle = fillStyle;\n    context.fillRect(0, 0, width, height);\n\n    if (options.beforeDraw) {\n      options.beforeDraw.call(this, context, canvas);\n    }\n\n    if (this.aborted) {\n      return;\n    }\n\n    context.save();\n    context.translate(width / 2, height / 2);\n    context.rotate((rotate * Math.PI) / 180);\n    context.scale(scaleX, scaleY);\n    context.drawImage(image, destX, destY, destWidth, destHeight);\n    context.restore();\n\n    if (options.drew) {\n      options.drew.call(this, context, canvas);\n    }\n\n    if (this.aborted) {\n      return;\n    }\n\n    const done = (result) => {\n      if (!this.aborted) {\n        this.done({\n          naturalWidth,\n          naturalHeight,\n          result,\n        });\n      }\n    };\n\n    if (canvas.toBlob) {\n      canvas.toBlob(done, options.mimeType, options.quality);\n    } else {\n      done(toBlob(canvas.toDataURL(options.mimeType, options.quality)));\n    }\n  }\n\n  done({\n    naturalWidth,\n    naturalHeight,\n    result,\n  }) {\n    const { file, image, options } = this;\n\n    if (URL && !options.checkOrientation) {\n      URL.revokeObjectURL(image.src);\n    }\n\n    if (result) {\n      // Returns original file if the result is greater than it and without size related options\n      if (options.strict && result.size > file.size && options.mimeType === file.type && !(\n        options.width > naturalWidth\n        || options.height > naturalHeight\n        || options.minWidth > naturalWidth\n        || options.minHeight > naturalHeight\n      )) {\n        result = file;\n      } else {\n        const date = new Date();\n\n        result.lastModified = date.getTime();\n        result.lastModifiedDate = date;\n        result.name = file.name;\n\n        // Convert the extension to match its type\n        if (result.name && result.type !== file.type) {\n          result.name = result.name.replace(\n            REGEXP_EXTENSION,\n            imageTypeToExtension(result.type),\n          );\n        }\n      }\n    } else {\n      // Returns original file if the result is null in some cases.\n      result = file;\n    }\n\n    this.result = result;\n\n    if (options.success) {\n      options.success.call(this, result);\n    }\n  }\n\n  fail(err) {\n    const { options } = this;\n\n    if (options.error) {\n      options.error.call(this, err);\n    } else {\n      throw err;\n    }\n  }\n\n  abort() {\n    if (!this.aborted) {\n      this.aborted = true;\n\n      if (this.reader) {\n        this.reader.abort();\n      } else if (!this.image.complete) {\n        this.image.onload = null;\n        this.image.onabort();\n      } else {\n        this.fail(new Error('The compression process has been aborted.'));\n      }\n    }\n  }\n\n  /**\n   * Get the no conflict compressor class.\n   * @returns {Compressor} The compressor class.\n   */\n  static noConflict() {\n    window.Compressor = AnotherCompressor;\n    return Compressor;\n  }\n\n  /**\n   * Change the default options.\n   * @param {Object} options - The new default options.\n   */\n  static setDefaults(options) {\n    Object.assign(DEFAULTS, options);\n  }\n}\n"],"names":["window","CanvasPrototype","HTMLCanvasElement","prototype","hasBlobConstructor","Blob","Boolean","e","hasArrayBufferViewSupport","Uint8Array","size","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","dataURIPattern","dataURLtoBlob","atob","ArrayBuffer","dataURI","matches","mediaType","isBase64","dataString","byteString","arrayBuffer","intArray","i","bb","match","Error","slice","length","decodeURIComponent","charCodeAt","type","append","getBlob","toBlob","mozGetAsFile","callback","quality","self","setTimeout","toDataURL","module","exports","input","Object","toString","call","strict","checkOrientation","maxWidth","Infinity","maxHeight","minWidth","minHeight","width","undefined","height","mimeType","convertSize","beforeDraw","drew","success","error","IS_BROWSER","document","WINDOW","Array","toArray","value","from","REGEXP_IMAGE_TYPE","isImageType","test","imageTypeToExtension","extension","substr","fromCharCode","String","getStringFromCharCode","dataView","start","str","getUint8","btoa","arrayBufferToDataURL","chunks","chunkSize","uint8","push","apply","subarray","join","resetAndGetOrientation","DataView","orientation","littleEndian","app1Start","ifdStart","byteLength","offset","exifIDCode","tiffOffset","endianness","getUint16","firstIFDOffset","getUint32","setUint16","parseOrientation","rotate","scaleX","scaleY","REGEXP_DECIMALS","normalizeDecimalNumber","times","Math","round","FileReader","URL","webkitURL","REGEXP_EXTENSION","AnotherCompressor","Compressor","file","options","image","Image","DEFAULTS","aborted","result","init","isBlob","fail","load","url","createObjectURL","reader","onload","target","data","onabort","onerror","onloadend","readAsArrayBuffer","readAsDataURL","draw","naturalWidth","naturalHeight","navigator","userAgent","crossOrigin","alt","name","src","canvas","createElement","context","getContext","aspectRatio","is90DegreesRotated","abs","max","floor","min","destX","destY","destWidth","destHeight","fillStyle","fillRect","save","translate","PI","scale","drawImage","restore","done","revokeObjectURL","date","Date","lastModified","getTime","lastModifiedDate","replace","err","abort","complete"],"mappings":"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"}